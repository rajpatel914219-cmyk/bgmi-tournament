<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Premium Dashboard</title>

<link rel="manifest" href="manifest.json">

<style>

/* ===============================
   üî• GLOBAL STYLE
================================ */

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:white;
  overflow-x:hidden;
}

/* ===============================
   üöÄ SPLASH SCREEN
================================ */

#splash{
  position:fixed;
  width:100%;
  height:100%;
  background:#020617;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  font-weight:bold;
  color:#22c55e;
  z-index:9999;
}

/* ===============================
   üîÑ LOADING OVERLAY
================================ */

#loading{
  position:fixed;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.loader{
  border:4px solid #1e293b;
  border-top:4px solid #22c55e;
  border-radius:50%;
  width:40px;
  height:40px;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  0%{transform:rotate(0)}
  100%{transform:rotate(360deg)}
}

/* ===============================
   üì¢ BROADCAST BAR
================================ */

.broadcast{
  display:none;
  padding:12px;
  text-align:center;
  font-size:13px;
  font-weight:bold;
  animation:slideDown .4s ease;
}

.broadcast.normal{
  background:#1e293b;
  color:#22c55e;
}

.broadcast.maintenance{
  background:#7f1d1d;
  color:#fff;
}

@keyframes slideDown{
  from{transform:translateY(-20px);opacity:0;}
  to{transform:translateY(0);opacity:1;}
}

/* ===============================
   üí∞ WALLET CARDS
================================ */

.cards{
  padding:15px;
  padding-bottom:90px;
}

.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(10px);
  padding:20px;
  border-radius:18px;
  margin-bottom:15px;
  box-shadow:0 0 20px rgba(34,197,94,0.2);
  transition:.3s;
}

.card:hover{
  transform:translateY(-4px);
}

.wallet-card{
  border:1px solid #22c55e;
}

.card-title{
  font-size:13px;
  opacity:.7;
}

.amount{
  font-size:24px;
  font-weight:bold;
  margin-top:5px;
}

/* ===============================
   üëë PREMIUM BADGE
================================ */

.badge{
  background:gold;
  color:black;
  font-size:10px;
  padding:3px 8px;
  border-radius:20px;
  font-weight:bold;
  display:none;
  animation:glow 1.5s infinite alternate;
}

@keyframes glow{
  from{box-shadow:0 0 5px gold;}
  to{box-shadow:0 0 15px gold;}
}

/* ===============================
   üî• BOTTOM NAVIGATION
================================ */

.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#0f172a;
  display:flex;
  justify-content:space-around;
  padding:12px 0;
  border-top:1px solid #1e293b;
}

.nav-btn{
  color:#64748b;
  font-size:12px;
  text-align:center;
  cursor:pointer;
  transition:.3s;
  position:relative;
}

.nav-btn.active{
  color:#22c55e;
  transform:scale(1.1);
}

.nav-btn.active::after{
  content:"";
  position:absolute;
  bottom:-6px;
  left:50%;
  transform:translateX(-50%);
  width:20px;
  height:3px;
  background:#22c55e;
  border-radius:5px;
}

</style>
</head>

<body>

<div id="splash">üöÄ Loading App...</div>
<div id="loading"><div class="loader"></div></div>

<div class="broadcast" id="broadcastBox"></div>

<div class="cards">

  <div class="card wallet-card">
    <div class="card-title">Wallet Balance</div>
    <div class="amount" id="walletAmount">‚Çπ 0</div>
    <span class="badge" id="premiumBadge">PREMIUM</span>
  </div>

  <div class="card">
    <div class="card-title">Bonus Balance</div>
    <div class="amount" id="bonusAmount">‚Çπ 0</div>
  </div>

  <div class="card">
    <div class="card-title">Withdrawable Balance</div>
    <div class="amount" id="withdrawAmount">‚Çπ 0</div>
  </div>

</div>

<div class="bottom-nav">
  <div class="nav-btn active" onclick="goPage('dashboard.html',this)">üè†<br>Home</div>
  <div class="nav-btn" onclick="goPage('wallet.html',this)">üí∞<br>Wallet</div>
  <div class="nav-btn" onclick="goPage('profile.html',this)">üë§<br>Profile</div>
</div>

<script type="module">

/* ===============================
   üî• FIREBASE IMPORTS
================================ */

import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { getDatabase, ref, onValue } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getMessaging, getToken, onMessage } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

/* ===============================
   üîë FIREBASE CONFIG
================================ */

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain: "incoinpaysliveearning.firebaseapp.com",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning",
  storageBucket: "incoinpaysliveearning.firebasestorage.app",
  messagingSenderId: "971873814750",
  appId: "1:971873814750:web:7418c7da119e4725ed9a4f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const messaging = getMessaging(app);

/* ===============================
   üîî PUSH NOTIFICATION SYSTEM
================================ */

async function initPush() {

  try {

    const permission = await Notification.requestPermission();

    if(permission !== "granted"){
      console.log("Notification permission denied");
      return;
    }

    const token = await getToken(messaging, {
      vapidKey: "BOBXol2oluYC_itfEsmvhNh7P1VKIB1DmTC-E6lCnUHsueykBHBjIdyOE_AZGnXirxrA-9EKC65kwN3L4qOUQ7I"
    });

    console.log("FCM Token:", token);

    onAuthStateChanged(auth,(user)=>{
      if(user && token){
        ref(db,"users/"+user.uid+"/fcmToken").set(token);
      }
    });

  } catch(err){
    console.log("Push Error:", err);
  }

}

onMessage(messaging,(payload)=>{
  new Notification(payload.notification.title,{
    body:payload.notification.body,
    icon:"/icon.png"
  });
});

initPush();

/* ===============================
   üë§ AUTH + WALLET DATA
================================ */

const walletEl=document.getElementById("walletAmount");
const bonusEl=document.getElementById("bonusAmount");
const withdrawEl=document.getElementById("withdrawAmount");
const premiumBadge=document.getElementById("premiumBadge");
const broadcastBox=document.getElementById("broadcastBox");
const splash=document.getElementById("splash");
const loading=document.getElementById("loading");

setTimeout(()=>{ splash.style.display="none"; },1500);

onAuthStateChanged(auth,(user)=>{

  if(!user){
    window.location.href="login.html";
    return;
  }

  loading.style.display="flex";

  onValue(ref(db,"users/"+user.uid),(snap)=>{
    if(!snap.exists()) return;

    const data=snap.val();

    walletEl.innerText="‚Çπ "+(data.wallet||0);
    bonusEl.innerText="‚Çπ "+(data.bonus||0);
    withdrawEl.innerText="‚Çπ "+(data.withdrawable||0);

    if(data.premium===true){
      premiumBadge.style.display="inline-block";
    }

    loading.style.display="none";
  });

});

/* ===============================
   üì¢ LIVE BROADCAST SYSTEM
================================ */

onValue(ref(db,"broadcast"),(snap)=>{

  if(!snap.exists()) return;

  const data=snap.val();

  if(data.active===true){

    broadcastBox.style.display="block";
    broadcastBox.innerText=data.message||"";

    broadcastBox.classList.remove("normal","maintenance");

    if(data.type==="maintenance"){
      broadcastBox.classList.add("maintenance");
      document.body.innerHTML="<h2 style='text-align:center;margin-top:50%'>üöß Maintenance Mode</h2>";
    }else{
      broadcastBox.classList.add("normal");
    }

  }else{
    broadcastBox.style.display="none";
  }

});

/* ===============================
   üî• NAVIGATION
================================ */

window.goPage=function(page,el){
  document.querySelectorAll(".nav-btn").forEach(btn=>{
    btn.classList.remove("active");
  });
  el.classList.add("active");
  setTimeout(()=>{window.location.href=page},150);
}

</script>

</body>
</html>
