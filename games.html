<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Games - Premium App</title>

<style>

/* ===== GLOBAL ===== */

body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
  padding-bottom:80px;
}

.header{
  background:#111827;
  padding:15px;
  text-align:center;
  font-weight:bold;
  font-size:18px;
  border-bottom:1px solid #1f2937;
}

/* ===== GAME CARD ===== */

.game-card{
  background:#1e293b;
  margin:15px;
  border-radius:15px;
  padding:15px;
  box-shadow:0 0 10px rgba(0,0,0,.4);
}

.game-title{
  font-size:16px;
  font-weight:bold;
  margin-bottom:10px;
}

.game-info{
  font-size:13px;
  opacity:.8;
  margin-bottom:10px;
}

.join-btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.join-btn:active{
  transform:scale(.98);
}

/* ===== BOTTOM NAV ===== */

.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  background:#111827;
  border-top:1px solid #1f2937;
}

.nav-item{
  flex:1;
  text-align:center;
  padding:12px;
  font-size:12px;
  color:#9ca3af;
  cursor:pointer;
}

.nav-item.active{
  color:#22c55e;
  font-weight:bold;
}

</style>
</head>

<body>

<div class="header">üéÆ Live Games</div>

<!-- GAME LIST -->

<div id="gamesList"></div>

<!-- BOTTOM NAV -->

<div class="bottom-nav">
  <div class="nav-item" onclick="goHome()">üè†<br>Home</div>
  <div class="nav-item" onclick="goWallet()">üí≥<br>Wallet</div>
  <div class="nav-item active">üéÆ<br>Games</div>
  <div class="nav-item" onclick="goProfile()">üë§<br>Profile</div>
</div>

<script type="module">

import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { getAuth,onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getDatabase,ref,get,update,push,set } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üî• Firebase Config */

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain: "incoinpaysliveearning.firebaseapp.com",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning",
  storageBucket: "incoinpaysliveearning.firebasestorage.app",
  messagingSenderId: "971873814750",
  appId: "1:971873814750:web:7418c7da119e4725ed9a4f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* üîê Login Check */

onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="login.html";
  }else{
    loadGames(user.uid);
  }
});

/* üéÆ Load Games */

async function loadGames(uid){

  const gamesRef = ref(db,"games");
  const snapshot = await get(gamesRef);

  const container = document.getElementById("gamesList");
  container.innerHTML="";

  if(snapshot.exists()){

    snapshot.forEach(game=>{
      const data = game.val();

      container.innerHTML += `
      <div class="game-card">
        <div class="game-title">${data.title}</div>
        <div class="game-info">
          Entry: ‚Çπ${data.entry} <br>
          Prize: ‚Çπ${data.prize}
        </div>
        <button class="join-btn"
        onclick="joinGame('${game.key}',${data.entry})">
        Join Match
        </button>
      </div>
      `;
    });

  }else{
    container.innerHTML="<p style='text-align:center;margin-top:20px;'>No Games Available</p>";
  }
}

/* üí∞ Join Game */

window.joinGame = async function(gameId,entry){

  const user = auth.currentUser;
  const uid = user.uid;

  const walletRef = ref(db,"users/"+uid+"/wallet");
  const walletSnap = await get(walletRef);

  if(walletSnap.exists()){

    let balance = walletSnap.val();

    if(balance >= entry){

      balance -= entry;

      await update(ref(db,"users/"+uid),{
        wallet: balance
      });

      await push(ref(db,"gameEntries/"+gameId),{
        userId: uid,
        status: "joined",
        time: Date.now()
      });

      alert("‚úÖ Joined Successfully");

    }else{
      alert("‚ùå Insufficient Balance");
    }

  }
}

/* NAVIGATION */

window.goHome = ()=> window.location.href="dashboard.html";
window.goWallet = ()=> window.location.href="wallet.html";
window.goProfile = ()=> window.location.href="profile.html";

</script>

</body>
</html>
