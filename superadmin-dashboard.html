<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Professional Multi Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  padding:15px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

.title{
  font-size:20px;
  font-weight:bold;
  color:#22c55e;
}

.card{
  background:#111827;
  padding:15px;
  border-radius:15px;
  margin-bottom:20px;
}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:8px;
  background:#1e293b;
  color:white;
}

button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

.create-btn{
  width:100%;
  background:#22c55e;
  margin-top:8px;
}

.logout{
  background:#ef4444;
  color:white;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  padding:8px;
  text-align:center;
  border-bottom:1px solid #1e293b;
}

th{background:#16a34a}

.action-btn{
  margin:2px;
}
</style>
</head>

<body>

<div class="header">
  <div class="title">ðŸ‘‘ PROFESSIONAL MULTI ADMIN PANEL</div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- CREATE ADMIN -->
<div class="card">
  <h3>Create Admin</h3>
  <input type="email" id="email" placeholder="Admin Email">
  <input type="password" id="password" placeholder="Password">
  <select id="role">
    <option value="admin">Admin</option>
    <option value="viewer">Viewer</option>
  </select>
  <button class="create-btn" onclick="createAdmin()">Create</button>
  <p id="msg"></p>
</div>

<!-- ADMIN LIST -->
<div class="card">
  <h3>All Admins</h3>
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="adminTable"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
  getAuth,
  onAuthStateChanged,
  signOut,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword
} from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getDatabase,
  ref,
  get,
  set,
  update,
  remove,
  onValue
} from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ðŸ”¥ CONFIG */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const table = document.getElementById("adminTable");
const msg = document.getElementById("msg");

let currentUID = null;

/* ðŸ” AUTH CHECK */
onAuthStateChanged(auth, async(user)=>{
  if(!user){
    window.location.href="admin-login.html";
    return;
  }

  currentUID = user.uid;

  const snap = await get(ref(db,"admins/"+user.uid));

  if(!snap.exists() || snap.val().role !== "superadmin"){
    alert("Access Denied");
    window.location.href="admin-login.html";
  }
});

/* âž• CREATE ADMIN */
window.createAdmin = async ()=>{

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value;

  if(!email || !password){
    msg.innerText="Fill all fields";
    return;
  }

  try{
    const superEmail = auth.currentUser.email;
    const superPass = prompt("Enter your password:");

    const userCred = await createUserWithEmailAndPassword(auth,email,password);
    const newUID = userCred.user.uid;

    await set(ref(db,"admins/"+newUID),{
      email:email,
      role:role,
      status:"active",
      createdAt:Date.now(),
      createdBy:currentUID
    });

    await signInWithEmailAndPassword(auth,superEmail,superPass);

    msg.innerText="Admin Created Successfully";
    msg.style.color="#22c55e";

  }catch(e){
    msg.innerText=e.message;
    msg.style.color="red";
  }
};

/* ðŸ“‹ LOAD ADMINS */
onValue(ref(db,"admins"),(snapshot)=>{

  table.innerHTML="";

  if(!snapshot.exists()){
    table.innerHTML="<tr><td colspan='4'>No Admins</td></tr>";
    return;
  }

  const data = snapshot.val();

  Object.keys(data).forEach(uid=>{

    const admin = data[uid];

    const row = `
      <tr>
        <td>${admin.email}</td>
        <td>${admin.role}</td>
        <td>${admin.status}</td>
        <td>
          ${uid!==currentUID ? `
          <button class="action-btn" onclick="toggleStatus('${uid}')">Toggle</button>
          <button class="action-btn" onclick="deleteAdmin('${uid}')">Delete</button>
          ` : 'Self'}
        </td>
      </tr>
    `;

    table.innerHTML+=row;
  });
});

/* ðŸ” TOGGLE STATUS */
window.toggleStatus = async(uid)=>{
  const snap = await get(ref(db,"admins/"+uid));
  const current = snap.val().status;

  await update(ref(db,"admins/"+uid),{
    status: current==="active" ? "disabled":"active"
  });
};

/* âŒ DELETE */
window.deleteAdmin = async(uid)=>{
  if(confirm("Delete this admin?")){
    await remove(ref(db,"admins/"+uid));
  }
};

/* ðŸšª LOGOUT */
window.logout = async()=>{
  await signOut(auth);
  window.location.href="admin-login.html";
};
</script>

</body>
</html>
