<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:Arial, sans-serif;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:white;
  padding:15px;
}

.container{
  max-width:700px;
  margin:auto;
}

h2{
  text-align:center;
  color:#22c55e;
  margin-bottom:15px;
}

.card{
  background:#0b1220;
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
  box-shadow:0 0 20px rgba(34,197,94,.2);
}

select{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#111827;
  color:white;
  font-size:14px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  padding:12px;
  text-align:center;
  border-bottom:1px solid #1e293b;
}

th{
  background:#16a34a;
}

tr:nth-child(even){
  background:#111827;
}

.rank{
  font-weight:bold;
}

.gold{background:#facc15;color:black;font-weight:bold}
.silver{background:#cbd5e1;color:black;font-weight:bold}
.bronze{background:#fb923c;color:black;font-weight:bold}

.stats{
  text-align:center;
  margin-top:10px;
  font-size:14px;
  opacity:.8;
}

#msg{
  text-align:center;
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸ“Š ADMIN MATCH LEADERBOARD</h2>

<div class="card">
  <label>Select Match:</label>
  <select id="matchSelect"></select>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Player</th>
        <th>Kills</th>
        <th>Points</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody"></tbody>
  </table>
  <div class="stats" id="stats"></div>
</div>

<p id="msg"></p>

</div>

<script type="module">
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getDatabase, ref, onValue }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const matchSelect = document.getElementById("matchSelect");
const leaderboardBody = document.getElementById("leaderboardBody");
const stats = document.getElementById("stats");

/* ðŸ” PROTECT PAGE */
onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="admin-login.html";
  }
});

/* ðŸ”¥ LOAD MATCH LIST */
onValue(ref(db,"matches"),(snapshot)=>{

  matchSelect.innerHTML="";

  if(!snapshot.exists()){
    matchSelect.innerHTML="<option>No Matches</option>";
    return;
  }

  snapshot.forEach(child=>{
    const option=document.createElement("option");
    option.value=child.key;
    option.innerText=child.key;
    matchSelect.appendChild(option);
  });

});

/* ðŸ”¥ LOAD LEADERBOARD WHEN MATCH SELECTED */
matchSelect.addEventListener("change",loadLeaderboard);

function loadLeaderboard(){

  const match = matchSelect.value;

  if(!match) return;

  onValue(ref(db,"matchData/"+match),(snapshot)=>{

    leaderboardBody.innerHTML="";

    if(!snapshot.exists()){
      leaderboardBody.innerHTML="<tr><td colspan='4'>No Data</td></tr>";
      stats.innerText="";
      return;
    }

    const data = snapshot.val();

    const players = Object.keys(data).map(key=>{
      return {
        name:data[key].name || key,
        kills:Number(data[key].kills)||0,
        points:Number(data[key].points)||0
      }
    });

    players.sort((a,b)=> b.points - a.points);

    players.forEach((player,index)=>{

      let rowClass="";
      if(index===0) rowClass="gold";
      if(index===1) rowClass="silver";
      if(index===2) rowClass="bronze";

      leaderboardBody.innerHTML+=`
        <tr class="${rowClass}">
          <td class="rank">${index+1}</td>
          <td>${player.name}</td>
          <td>${player.kills}</td>
          <td>${player.points}</td>
        </tr>
      `;
    });

    stats.innerText=`Total Players: ${players.length}`;
  });

}
</script>

</body>
</html>
