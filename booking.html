<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BGMI Live Matches</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#020617;
  font-family:Arial;
  color:white;
  padding:15px;
}

.title{
  text-align:center;
  font-size:22px;
  color:#22c55e;
  margin-bottom:10px;
}

.wallet{
  text-align:center;
  background:#0f172a;
  padding:12px;
  border-radius:12px;
  margin-bottom:20px;
  font-weight:bold;
  color:#38bdf8;
}

.card{
  background:#0f172a;
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
  box-shadow:0 0 20px rgba(34,197,94,.2);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.card-left{ width:70%; }

.card-left h3{
  margin:0;
  color:#22c55e;
}

.slot{
  font-size:12px;
  color:#38bdf8;
}

.join-btn{
  width:70px;
  height:32px;
  border:none;
  border-radius:20px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:white;
  cursor:pointer;
  font-size:12px;
}

#msg{
  text-align:center;
  margin-top:10px;
  font-weight:bold;
}

/* üî• MODAL */
.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.modal-box{
  background:#0f172a;
  padding:20px;
  border-radius:15px;
  width:280px;
  text-align:center;
}

.modal-box input{
  width:100%;
  padding:10px;
  margin:10px 0;
  border-radius:8px;
  border:none;
  outline:none;
}

.modal-box button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#22c55e;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="title">üéÆ BGMI LIVE MATCHES</div>

<div class="wallet">
  üí∞ Wallet: ‚Çπ <span id="walletBalance">0</span>
</div>

<!-- SOLO -->
<div class="card">
  <div class="card-left">
    <h3>ü•á SOLO</h3>
    <p class="slot">Slots: <span id="soloCount">0</span>/100</p>
  </div>
  <button class="join-btn" onclick="openSecurity('solo',10,100)">JOIN</button>
</div>

<!-- DUO -->
<div class="card">
  <div class="card-left">
    <h3>ü•à DUO</h3>
    <p class="slot">Slots: <span id="duoCount">0</span>/50</p>
  </div>
  <button class="join-btn" onclick="openSecurity('duo',20,50)">JOIN</button>
</div>

<!-- SQUAD -->
<div class="card">
  <div class="card-left">
    <h3>üèÜ SQUAD</h3>
    <p class="slot">Slots: <span id="squadCount">0</span>/25</p>
  </div>
  <button class="join-btn" onclick="openSecurity('squad',40,25)">JOIN</button>
</div>

<!-- TDM -->
<div class="card">
  <div class="card-left">
    <h3>‚öîÔ∏è TDM</h3>
    <p class="slot">Slots: <span id="tdmCount">0</span>/20</p>
  </div>
  <button class="join-btn" onclick="openSecurity('tdm',15,20)">JOIN</button>
</div>

<div id="msg"></div>

<!-- üî• SECURITY MODAL -->
<div class="modal" id="securityModal">
  <div class="modal-box" id="modalInner">
    <h3>Enter Security Code</h3>
    <input type="password" id="securityInput" placeholder="Security Code">
    <button onclick="verifySecurity()">Verify</button>
  </div>
</div>

<script type="module">
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get, update, push, onValue }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userId="demoUser";
let selectedType, selectedFee, selectedMax;

const walletEl=document.getElementById("walletBalance");
const msg=document.getElementById("msg");
const modal=document.getElementById("securityModal");

/* Close popup on outside click */
modal.addEventListener("click",(e)=>{
  if(e.target===modal){
    modal.style.display="none";
  }
});

/* Live wallet */
onValue(ref(db,"users/"+userId+"/wallet"),snap=>{
  walletEl.innerText=snap.exists()?snap.val():0;
});

/* Slot listeners */
function listen(type,id){
  onValue(ref(db,"matches/"+type+"/players"),snap=>{
    let count=snap.exists()?Object.keys(snap.val()).length:0;
    document.getElementById(id).innerText=count;
  });
}

listen("solo","soloCount");
listen("duo","duoCount");
listen("squad","squadCount");
listen("tdm","tdmCount");

/* Open security modal */
window.openSecurity=(type,fee,max)=>{
  selectedType=type;
  selectedFee=fee;
  selectedMax=max;
  document.getElementById("securityInput").value="";
  modal.style.display="flex";
};

/* Verify code */
window.verifySecurity=async()=>{

  const entered=document.getElementById("securityInput").value;
  if(!entered) return;

  const codeSnap=await get(ref(db,"matchSecurity/"+selectedType));
  if(!codeSnap.exists()){
    return showMsg("‚ùå Code Not Set","red");
  }

  if(entered!==codeSnap.val()){
    return showMsg("‚ùå Wrong Code","red");
  }

  modal.style.display="none";

  const playerName=prompt("Enter Player Name:");
  if(!playerName) return;

  const walletSnap=await get(ref(db,"users/"+userId+"/wallet"));
  let balance=walletSnap.exists()?walletSnap.val():0;

  if(balance<selectedFee){
    return showMsg("‚ùå Not Enough Balance","red");
  }

  const playersSnap=await get(ref(db,"matches/"+selectedType+"/players"));
  let count=playersSnap.exists()?Object.keys(playersSnap.val()).length:0;

  if(count>=selectedMax){
    return showMsg("‚ö†Ô∏è Match Full","orange");
  }

  balance-=selectedFee;

  await update(ref(db,"users/"+userId),{wallet:balance});

  await push(ref(db,"matches/"+selectedType+"/players"),{
    userId,
    playerName,
    joinedAt:Date.now()
  });

  showMsg("‚úÖ Joined "+selectedType.toUpperCase(),"#22c55e");
};

function showMsg(text,color){
  msg.innerText=text;
  msg.style.color=color;
}
</script>

</body>
</html>
