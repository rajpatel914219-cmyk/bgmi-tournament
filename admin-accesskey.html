<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Access Key Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#020617;
  font-family:Arial;
  color:white;
}
.box{
  max-width:500px;
  margin:40px auto;
  background:#0f172a;
  padding:22px;
  border-radius:14px;
}
h2{text-align:center;}
select,button{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:8px;
}
select{background:#020617;color:white;}
button{
  background:#22c55e;
  font-weight:bold;
  cursor:pointer;
}
.key{
  background:#020617;
  padding:12px;
  border-radius:10px;
  margin-top:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}
.key-info{
  font-size:14px;
}
.active{border-left:4px solid #22c55e;}
.expired{border-left:4px solid #ef4444;opacity:.7;}

.actions button{
  padding:6px 10px;
  border-radius:6px;
  font-size:13px;
}
.copy{background:#2563eb;}
.delete{background:#ef4444;}
</style>
</head>

<body>

<div class="box">
  <h2>ğŸ”‘ Access Key Manager</h2>

  <select id="duration">
    <option value="1">1 Hour</option>
    <option value="3" selected>3 Hours</option>
    <option value="6">6 Hours</option>
  </select>

  <button onclick="generateKey()">Generate New Key</button>

  <h3>ğŸ“‹ All Keys</h3>
  <div id="list"></div>
</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, set, onValue, remove
} from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import {
  getAuth, onAuthStateChanged
} from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain:"incoinpaysliveearning.firebaseapp.com",
  databaseURL:"https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId:"incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* ğŸ”’ ADMIN AUTH CHECK */
onAuthStateChanged(auth,user=>{
  if(!user){
    location.href="login.html";
  }
});

/* ğŸ” KEY GENERATOR */
function randomKey(){
  return "BGMI-" + Math.random().toString(36).substr(2,6).toUpperCase();
}

window.generateKey = async ()=>{
  const hours = Number(duration.value);
  const key = randomKey();

  await set(ref(db,"accessKeys/"+key),{
    createdAt: Date.now(),
    expireAt: Date.now() + hours*3600000,
    used:false,
    deviceId:null
  });
};

/* ğŸ“‹ KEY LIST + COPY + DELETE */
onValue(ref(db,"accessKeys"),snap=>{
  const list=document.getElementById("list");
  list.innerHTML="";

  snap.forEach(s=>{
    const d=s.val();
    const expired = Date.now() > d.expireAt;

    const div=document.createElement("div");
    div.className=`key ${expired?"expired":"active"}`;

    div.innerHTML=`
      <div class="key-info">
        <b>${s.key}</b><br>
        ${expired?"â³ Expired":"ğŸŸ¢ Active"} |
        ${d.used?"ğŸ” Used":"ğŸ†“ Unused"}
      </div>

      <div class="actions">
        <button class="copy">ğŸ“‹</button>
        <button class="delete">ğŸ—‘</button>
      </div>
    `;

    /* COPY */
    div.querySelector(".copy").onclick=()=>{
      navigator.clipboard.writeText(s.key);
      alert("Key copied!");
    };

    /* DELETE */
    div.querySelector(".delete").onclick=()=>{
      if(confirm("Delete this key?")){
        remove(ref(db,"accessKeys/"+s.key));
      }
    };

    list.appendChild(div);
  });
});
</script>

</body>
</html>
