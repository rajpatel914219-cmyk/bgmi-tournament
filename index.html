<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BGMI Slot Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<style>
*{
  box-sizing:border-box;
}

body{
  margin:0;
  min-height:100vh;
  background:#0f172a;
  font-family:Arial, sans-serif;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px;
}

.box{
  width:100%;
  max-width:380px;
  background:#1e293b;
  padding:18px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.header h2{
  font-size:18px;
  margin:0;
}

.header a{
  color:#38bdf8;
  text-decoration:none;
  font-weight:bold;
  font-size:14px;
}

input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border:none;
  border-radius:8px;
  font-size:15px;
}

input{
  background:#0f172a;
  color:white;
}

input::placeholder{
  color:#94a3b8;
}

button{
  background:#22c55e;
  font-weight:bold;
  color:#022c22;
  cursor:pointer;
}

button:active{
  transform:scale(.98);
}

#fee{
  background:#020617;
  text-align:center;
  font-weight:bold;
}

#msg{
  margin-top:10px;
  font-weight:bold;
  text-align:center;
  font-size:14px;
}

.hidden{
  display:none;
}

/* ðŸ“± EXTRA SMALL DEVICES */
@media(max-width:360px){
  .header h2{
    font-size:16px;
  }
  input,button{
    font-size:14px;
    padding:11px;
  }
}
</style>
</head>

<body>

<div class="box">

  <!-- HEADER -->
  <div class="header">
    <h2>BGMI Slot Booking</h2>
    <a onclick="openRules()">Rules</a>
  </div>

  <!-- ACCESS KEY -->
  <div id="keySection">
    <input id="accessKey" placeholder="Enter Access Key">
    <button onclick="verifyKey()">Verify Key</button>
  </div>

  <!-- BOOKING FORM -->
  <div id="bookingForm" class="hidden">
    <input id="name" placeholder="Player Name" oninput="autoCapitalize(this)">
    <input id="bgmi" placeholder="BGMI ID">
    <input id="fee" value="â‚¹50 Entry Fee" readonly>
    <button onclick="submitForm()">Book Slot</button>
  </div>

  <p id="msg"></p>

</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get, update }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  databaseURL:"https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* DEVICE ID */
function getDeviceId(){
  let id = localStorage.getItem("bgmi_device");
  if(!id){
    id = "dev-" + Math.random().toString(36).substr(2,10);
    localStorage.setItem("bgmi_device",id);
  }
  return id;
}

/* AUTO CAPITAL */
window.autoCapitalize = el => el.value = el.value.toUpperCase();

/* RULES */
window.openRules = ()=>window.open("rules.html","_blank");

/* VERIFY ACCESS KEY */
window.verifyKey = async ()=>{
  const key = accessKey.value.trim();
  const msg = document.getElementById("msg");
  const deviceId = getDeviceId();

  if(!key){
    msg.innerHTML="âŒ Enter access key";
    msg.style.color="red";
    return;
  }

  const snap = await get(ref(db,"accessKeys/"+key));
  if(!snap.exists()){
    msg.innerHTML="âŒ Invalid key";
    msg.style.color="red";
    return;
  }

  const data = snap.val();
  if(Date.now() > data.expireAt){
    msg.innerHTML="â³ Key expired";
    msg.style.color="red";
    return;
  }

  if(data.used && data.deviceId !== deviceId){
    msg.innerHTML="ðŸš« Key already used on another device";
    msg.style.color="red";
    return;
  }

  await update(ref(db,"accessKeys/"+key),{
    used:true,
    deviceId
  });

  keySection.style.display="none";
  bookingForm.classList.remove("hidden");

  msg.innerHTML="âœ… Booking Open";
  msg.style.color="#22c55e";
};

/* SUBMIT */
window.submitForm = ()=>{
  const name = document.getElementById("name").value.trim();
  const bgmi = document.getElementById("bgmi").value.trim();
  const msg = document.getElementById("msg");

  if(!name || !bgmi){
    msg.innerHTML="âŒ Fill all details";
    msg.style.color="red";
    return;
  }

  msg.innerHTML="âœ… Slot Booked! Redirecting...";
  msg.style.color="#22c55e";

  setTimeout(()=>{
    window.location.href="dashboard.html";
  },1000);
};
</script>

</body>
</html>
