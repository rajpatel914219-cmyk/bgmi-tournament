<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel</title>

<style>
body{
  margin:0;
  background:#0f172a;
  font-family:Arial;
  color:white;
}

.header{
  padding:15px;
  background:#020617;
  text-align:center;
  font-weight:bold;
  color:#22c55e;
}

.section{
  padding:15px;
}

.card{
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}

input,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}

button{
  background:#22c55e;
  color:black;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="header">ðŸ”¥ ADMIN PANEL</div>

<div class="section">

<!-- ðŸ“¢ Broadcast -->
<div class="card">
<h3>Send Broadcast</h3>
<input type="text" id="broadcastMsg" placeholder="Enter Message">
<button onclick="sendBroadcast()">Send</button>
</div>

<!-- ðŸ’³ Recharge Requests -->
<div class="card">
<h3>Recharge Requests</h3>
<div id="rechargeList"></div>
</div>

<!-- ðŸ’¸ Withdraw Requests -->
<div class="card">
<h3>Withdraw Requests</h3>
<div id="withdrawList"></div>
</div>

</div>

<script type="module">

import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { getDatabase, ref, onValue, update, remove } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain: "incoinpaysliveearning.firebaseapp.com",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning",
  storageBucket: "incoinpaysliveearning.firebasestorage.app",
  messagingSenderId: "971873814750",
  appId: "1:971873814750:web:7418c7da119e4725ed9a4f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ==========================
   ðŸ“¢ BROADCAST SYSTEM
========================== */

window.sendBroadcast=function(){
  const msg=document.getElementById("broadcastMsg").value;
  update(ref(db,"broadcast"),{
    active:true,
    message:msg,
    type:"normal"
  });
  alert("Broadcast Sent");
}

/* ==========================
   ðŸ’³ RECHARGE APPROVAL
========================== */

const rechargeList=document.getElementById("rechargeList");

onValue(ref(db,"rechargeRequests"),(snap)=>{
  rechargeList.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    if(data.status==="pending"){
      rechargeList.innerHTML+=`
        <div>
        â‚¹ ${data.amount}
        <button onclick="approveRecharge('${child.key}','${data.uid}',${data.amount})">Approve</button>
        </div>
      `;
    }
  });
});

window.approveRecharge=function(id,uid,amount){

  update(ref(db,"users/"+uid),{
    wallet: increment(amount)
  });

  update(ref(db,"rechargeRequests/"+id),{
    status:"approved"
  });

  alert("Recharge Approved");
}

/* ==========================
   ðŸ’¸ WITHDRAW APPROVAL
========================== */

const withdrawList=document.getElementById("withdrawList");

onValue(ref(db,"withdrawRequests"),(snap)=>{
  withdrawList.innerHTML="";
  snap.forEach(child=>{
    const data=child.val();
    if(data.status==="pending"){
      withdrawList.innerHTML+=`
        <div>
        â‚¹ ${data.amount}
        <button onclick="approveWithdraw('${child.key}','${data.uid}',${data.amount})">Approve</button>
        </div>
      `;
    }
  });
});

window.approveWithdraw=function(id,uid,amount){

  update(ref(db,"users/"+uid),{
    withdrawable: increment(-amount)
  });

  update(ref(db,"withdrawRequests/"+id),{
    status:"approved"
  });

  alert("Withdraw Approved");
}

</script>

</body>
</html>
