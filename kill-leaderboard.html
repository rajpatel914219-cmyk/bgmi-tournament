<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BGMI Kill Point Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f172a;
  color:white;
  padding:20px;
  text-align:center;
}

h2{
  color:#22c55e;
}

select{
  padding:8px;
  border-radius:6px;
  border:none;
  margin-top:10px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th, td{
  padding:10px;
  border-bottom:1px solid #334155;
}

th{
  background:#16a34a;
}

.gold{background:gold;color:black;}
.silver{background:silver;color:black;}
.bronze{background:#cd7f32;color:black;}
</style>
</head>

<body>

<h2>ðŸŽ® BGMI KILL POINT LEADERBOARD</h2>

<label>Select Match:</label>
<select id="matchSelect"></select>

<table>
<thead>
<tr>
<th>Rank</th>
<th>Player UID</th>
<th>Kills</th>
<th>Position</th>
<th>Total Points</th>
</tr>
</thead>
<tbody id="leaderboardBody"></tbody>
</table>

<script type="module">
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { getDatabase, ref, get, onValue } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const matchSelect = document.getElementById("matchSelect");
const tableBody = document.getElementById("leaderboardBody");

/* ðŸ“‹ LOAD MATCH LIST */
async function loadMatches(){
  const snap = await get(ref(db,"bgmiTournament/matches"));
  matchSelect.innerHTML = "";

  if(!snap.exists()){
    matchSelect.innerHTML = "<option>No Matches</option>";
    return;
  }

  snap.forEach(child=>{
    const option = document.createElement("option");
    option.value = child.key;
    option.innerText = child.key;
    matchSelect.appendChild(option);
  });

  loadLeaderboard(matchSelect.value);
}

matchSelect.addEventListener("change", ()=>{
  loadLeaderboard(matchSelect.value);
});

/* ðŸ† LOAD LEADERBOARD */
function loadLeaderboard(matchId){

  const lbRef = ref(db,`bgmiTournament/matches/${matchId}/results`);

  onValue(lbRef,(snap)=>{

    tableBody.innerHTML = "";

    if(!snap.exists()){
      tableBody.innerHTML = 
      "<tr><td colspan='5'>No Data Available</td></tr>";
      return;
    }

    const players = Object.entries(snap.val()).map(([uid,val])=>({
      uid,
      kills: val.kills || 0,
      position: val.position || "-",
      totalPoints: val.totalPoints || 0
    }));

    // ðŸ”¥ SORT BY TOTAL POINTS
    players.sort((a,b)=> b.totalPoints - a.totalPoints);

    players.forEach((player,index)=>{

      let className="";
      if(index===0) className="gold";
      if(index===1) className="silver";
      if(index===2) className="bronze";

      const row = `
        <tr class="${className}">
          <td>${index+1}</td>
          <td>${player.uid}</td>
          <td>${player.kills}</td>
          <td>${player.position}</td>
          <td>${player.totalPoints}</td>
        </tr>
      `;

      tableBody.innerHTML += row;
    });

  });
}

loadMatches();

</script>

</body>
</html>
