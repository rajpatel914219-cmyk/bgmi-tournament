<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BGMI Tournament Admin Dashboard PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#020617;
  font-family:Arial;
  color:white;
}

.box{
  max-width:1200px;
  margin:20px auto;
  background:#0f172a;
  padding:20px;
  border-radius:14px;
}

h2{
  text-align:center;
  margin-bottom:15px;
}

/* STATS */
.stats{
  display:flex;
  gap:15px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:15px;
}

.stat{
  background:#020617;
  padding:10px 15px;
  border-radius:8px;
  border:1px solid #1e293b;
  font-size:13px;
}

/* CONTROLS */
.controls{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:15px;
}

button{
  background:#1e293b;
  color:#22c55e;
  border:1px solid #22c55e;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
}

button:hover{
  background:#22c55e;
  color:black;
}

/* SEARCH */
.search{
  text-align:center;
  margin-bottom:15px;
}

.search input{
  padding:6px;
  width:250px;
  border-radius:6px;
  border:none;
}

/* GRID */
.slots{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
}

.slot{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:8px;
  padding:8px;
  min-height:120px;
  font-size:11px;
  position:relative;
}

.slot.booked{
  background:linear-gradient(135deg,#052e16,#022c22);
  border-color:#22c55e;
  box-shadow:0 0 8px rgba(34,197,94,.5);
}

.teamName{
  font-weight:bold;
  color:#38bdf8;
  margin-bottom:4px;
  font-size:12px;
}

.player{
  font-size:11px;
}

.captain{
  color:#facc15;
  font-weight:bold;
}

.badge{
  display:inline-block;
  padding:2px 6px;
  font-size:10px;
  border-radius:5px;
  margin-bottom:4px;
}

.paid{
  background:#22c55e;
  color:black;
}

.pending{
  background:#ef4444;
  color:white;
}

.delete-btn{
  margin-top:6px;
  background:#ef4444;
  color:white;
  border:none;
  padding:4px 6px;
  border-radius:5px;
  font-size:10px;
  cursor:pointer;
}

@media(max-width:768px){
  .slots{
    grid-template-columns:repeat(2,1fr);
  }
}
</style>
</head>

<body>

<div class="box">
<h2>üéÆ BGMI TOURNAMENT DASHBOARD PRO</h2>

<div class="stats">
  <div class="stat">üë• Teams: <span id="totalTeams">0</span>/25</div>
  <div class="stat">üí∞ Collection: ‚Çπ<span id="totalMoney">0</span></div>
  <div class="stat">üîí Slots: <span id="slotStatus">Open</span></div>
</div>

<div class="search">
  <input type="text" id="searchInput" placeholder="Search Team or Player..." onkeyup="filterTeams()">
</div>

<div class="controls">
  <button onclick="clearAll()">üßπ Clear All</button>
  <button onclick="exportCSV()">üìÅ Export CSV</button>
  <button onclick="toggleSlots()">üîí Toggle Slot Lock</button>
</div>

<div class="slots" id="slots"></div>

</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, remove, update }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const slotsDiv = document.getElementById("slots");
const TOTAL_TEAMS = 25;
const ENTRY_FEE = 100;

let bookingData = {};
let slotOpen = true;

/* DRAW EMPTY GRID */
function drawEmpty(){
  slotsDiv.innerHTML="";
  for(let i=1;i<=TOTAL_TEAMS;i++){
    slotsDiv.innerHTML+=`
      <div class="slot" id="team-${i}">
        <div class="teamName">Team ${i}</div>
        <div>Empty</div>
      </div>
    `;
  }
}
drawEmpty();

/* REALTIME BOOKINGS */
onValue(ref(db,"bookings"), snap=>{
  drawEmpty();
  bookingData={};
  let count=0;
  let money=0;

  if(!snap.exists()){
    document.getElementById("totalTeams").innerText=0;
    document.getElementById("totalMoney").innerText=0;
    return;
  }

  let i=1;
  snap.forEach(child=>{
    if(i > TOTAL_TEAMS) return;

    const d = child.val();
    bookingData[i] = child.key;
    count++;

    const slot = document.getElementById("team-"+i);
    slot.classList.add("booked");

    let paymentBadge="";
    if(d.paid){
      paymentBadge=`<div class="badge paid">PAID</div>`;
      money+=ENTRY_FEE;
    }else{
      paymentBadge=`<div class="badge pending">PENDING</div>`;
    }

    let playersHTML="";
    if(d.players){
      d.players.forEach((p,index)=>{
        if(index===0){
          playersHTML+=`<div class="player captain">üëë ${p.name}</div>`;
        }else{
          playersHTML+=`<div class="player">${p.name}</div>`;
        }
      });
    }

    slot.innerHTML=`
      ${paymentBadge}
      <div class="teamName">${d.teamName}</div>
      ${playersHTML}
      <button class="delete-btn" onclick="deleteTeam(${i})">‚ùå Delete</button>
    `;

    i++;
  });

  document.getElementById("totalTeams").innerText=count;
  document.getElementById("totalMoney").innerText=money;
});

/* DELETE TEAM */
window.deleteTeam = function(teamNo){
  const key = bookingData[teamNo];
  if(!key) return;

  if(confirm("Delete Full Team?")){
    remove(ref(db,"bookings/"+key));
  }
};

/* CLEAR ALL */
window.clearAll=()=>{
  if(confirm("Clear ALL Teams?")){
    remove(ref(db,"bookings"));
  }
};

/* SLOT LOCK */
onValue(ref(db,"tournament/settings"), snap=>{
  if(snap.exists()){
    slotOpen = snap.val().slotsOpen;
  }
  document.getElementById("slotStatus").innerText = slotOpen ? "Open" : "Closed";
});

window.toggleSlots=()=>{
  update(ref(db,"tournament/settings"),{
    slotsOpen: !slotOpen
  });
};

/* SEARCH */
window.filterTeams=()=>{
  const input=document.getElementById("searchInput").value.toLowerCase();
  const slots=document.querySelectorAll(".slot");

  slots.forEach(slot=>{
    if(slot.innerText.toLowerCase().includes(input)){
      slot.style.display="block";
    }else{
      slot.style.display="none";
    }
  });
};

/* EXPORT CSV */
window.exportCSV=()=>{
  let csv="Team,Player Name,Payment\n";
  const slots=document.querySelectorAll(".slot.booked");

  slots.forEach(slot=>{
    const teamName=slot.querySelector(".teamName").innerText;
    const players=slot.querySelectorAll(".player");
    const paid=slot.querySelector(".paid")?"Paid":"Pending";

    players.forEach(p=>{
      csv+=`${teamName},${p.innerText.replace("üëë ","")},${paid}\n`;
    });
  });

  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="tournament-teams.csv";
  a.click();
};
</script>

</body>
</html>
